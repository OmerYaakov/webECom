<!DOCTYPE html>
<html data-bs-theme="auto" lang="he">

<%- include('partials/head') %>
    <%- include('logics/addtocartlogics') %>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                try {
                    $.ajax({
                        url: '/api/products',
                        method: 'GET',
                        success: function (products) {
                            const productList = $('.catalog-items');
                            productList.empty();
                            products.forEach(product => {
                                const productItem = $(`<div class="col-md-3">
                                                         <div class="product-card">
                                                            <div class="product-image-container">
                                                                <span class="badge badge-new">New</span>
                                                                <a href="/product/${product.productName}" class="product-link" title="${product.productName}">
                                                                    ${product.image && product.image !== "sdasdasdsa" ?
                                        `<img src="${product.image}" class="product-image" alt="${product.productName}">` :
                                        `<img src="https://placehold.jp/300x300.png" class="product-image" alt="Default Image">`}
                                                                </a>
                                                            </div>
                                                        <div class="product-details row" style="flex-direction: row;">
                                                            <div class="col-md-8">
                                                            <a id="product-name" href="/product/${product.productName}" class="product-name text-right" style="color: black;"
                                                            title="${product.productName}">${product.productName}</a>
                                                            </div>
                                                        <div class="product-price col-md-1">
                                                            <span class="price">₪${product.price}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            `);
                                let buttonContainer = $(`<div id="button-container" class="text-center">
                                                    </div>`);
                                let button = $(`<button class="product-card" id="product-index-${product.id}}">add to cart</button>`);
                                button.click(() => {

                                });
                                buttonContainer.append(button);
                                productItem.append(buttonContainer);
                                productList.append(productItem);
                            });
                        },
                        error: function (error) {
                            console.error('Error fetching products:', error);
                        }
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                }
                // $('#filter-form').on('submit', async function (event) {
                //     event.preventDefault();
                //     const category = $('#category-select').val();
                //     const minPrice = $('#price-min').val();
                //     const maxPrice = $('#price-max').val();

                //     const queryParams = new URLSearchParams({
                //         category: category,
                //         minPrice: minPrice,
                //         maxPrice: maxPrice,
                //     });
                //     console.log(queryParams.toString());
                //     try {
                //         const response = await fetch(`/api/products?${queryParams.toString()}`);
                //         const filteredProducts = await response.json();

                //         const productList = $('.catalog-items');
                //         productList.empty();

                //         filteredProducts.forEach(product => {
                //             const productItem = $('<div>').addClass('col-md-3').html(`
                //         <div class="product-card">
                //             <div class="product-image-container">
                //                 <span class="badge badge-new">New</span>
                //                 <a href="/product/${product.productName}" class="product-link" title="${product.productName}">
                //                     ${product.image && product.image !== "sdasdasdsa" ?
                //                     `<img src="${product.image}" class="product-image" alt="${product.productName}">` :
                //                     `<img src="https://placehold.jp/300x300.png" class="product-image" alt="Default Image">`}
                //                 </a>
                //             </div>
                //             <div class="product-details row" style="flex-direction: row;">
                //                 <div class="col-md-8">
                //                     <a id="product-name" href="/product/${product.productName}" class="product-name text-right" style="color: black;"
                //                         title="${product.productName}">${product.productName}</a>
                //                 </div>
                //                 <div class="product-price col-md-1">
                //                     <span class="price">₪${product.price}</span>
                //                 </div>
                //             </div>
                //             <div class="text-center">
                //                 <button id="add_to_cart_btn" class="add-to-cart-button btn">הוסף לסל</button>
                //                 <button class="add-to-cart-button btn">אהבתי</button>
                //             </div>
                //         </div>
                // `);
                //             productList.append(productItem);
                //         });
                //     } catch (error) {
                //         console.error('Error fetching products:', error);
                //     }
                // });
            });
        </script>

        <body>
            <%- include('partials/nav') %>
                <div class="text-right px-2">
                    <h1>קטלוג מוצרים</h1>
                </div>
                <!-- Filter form -->
                <div class="container">
                    <div class="row justify-content-end mb-3">
                        <div class="col-md-12 text-right">
                            <form id="filter-form" class="form-inline">
                                <button type="submit" class="btn btn-primary mr-3">סנן</button>
                                <div class="form-group mr-3">
                                    <label class="mr-2" for="price-range">טווח מחירים: </label>
                                    <input type="number" class="form-control" id="price-min" placeholder="מחיר מינימלי"
                                        name="minPrice">
                                </div>

                                <div class="form-group">
                                    <input type="number" class="form-control" id="price-max" placeholder="מחיר מקסימלי"
                                        name="maxPrice">
                                </div>
                                <div class="form-group">
                                    <label class="mr-2" for="category-select">סנן לפי קטגוריה: </label>
                                    <select class="custom-select" id="category-select" name="category">
                                        <option value="">הכל</option>
                                        <!-- Add options for your categories here -->
                                        <option value="bracelet">צמיד</option>
                                        <option value="necklace">שרשרת</option>
                                        <option value="ring">טבעת</option>
                                        <option value="earring">עגיל</option>
                                        <option value="pendant">תליון</option>
                                        <option value="watch">שעון</option>
                                        <option value="other">אחר</option>
                                        <!-- ... more categories ... -->
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="row catalog-items">
                    </div>
                </div>
                <%- include('partials/footer') %>
        </body>

</html>